"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModuleMerger = void 0;
const typedoc_1 = require("typedoc");
const module_bundle_1 = require("./module_bundle");
/**
 * Merger that merges the content of modules based on their JSDoc module annotation.
 */
class ModuleMerger {
    /**
     * Creates a new merger instance.
     * @param project The project whose modules are merged.
     */
    constructor(project) {
        this.project = project;
    }
    /**
     * Performs the merging routine.
     */
    execute() {
        const moduleBundles = this.createModuleBundles();
        moduleBundles.forEach((bundle) => bundle.merge());
    }
    /**
     * Creates an identifier for the module's bundle.
     * @param module The module for which the identifier is generated.
     * @returns The identifier for the module's bundle.
     */
    // eslint-disable-next-line class-methods-use-this
    createModuleBundleId(module) {
        return module.name;
    }
    /**
     * Creates an object describing which modules of the project should be merged.
     * @returns The collection of module bundles.
     */
    createModuleBundles() {
        var _a, _b;
        const modules = ((_a = this.project.children) !== null && _a !== void 0 ? _a : []).filter((c) => c.kindOf(typedoc_1.ReflectionKind.Module));
        const moduleBundleMap = new Map();
        for (const module of modules) {
            const bundleId = this.createModuleBundleId(module);
            if (!moduleBundleMap.has(bundleId)) {
                moduleBundleMap.set(bundleId, new module_bundle_1.ModuleBundle(this.project));
            }
            (_b = moduleBundleMap.get(bundleId)) === null || _b === void 0 ? void 0 : _b.add(module);
        }
        return [...moduleBundleMap.values()];
    }
}
exports.ModuleMerger = ModuleMerger;
